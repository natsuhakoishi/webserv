NAME= webserv

VAL = -ggdb3
VAL_FLAG = --show-leak-kinds=all --leak-check=full --track-origins=yes
# comment $ASAN if dw use AddSan
ASAN = -fsanitize=address -g3
CXXFLAG= -Wall -Wextra -Werror $(ASAN) -std=c++98 -pedantic -I./includes/

#set path to config file
CONF = config/config.conf

SRCS_FILE= \
	server/main \
	server/TcpServer \
	http/GET \
	http/POST \
	http/DELETE \
	http/autoindex \
	http/Http \
	http/status \
	http/utils \
	config/Config \
	config/configRoute \
	config/configServer \
	config/helper

SRCS = $(addprefix srcs/, $(addsuffix .cpp, $(SRCS_FILE)))

OBJ_DIR = objs
OBJ:=$(SRCS:srcs/%.cpp=$(OBJ_DIR)/%.o)

$(OBJ_DIR)/%.o: srcs/%.cpp | $(OBJ_DIR)
	@c++ $(CXXFLAG) -c $< -o $@


all: $(NAME)

$(NAME): $(OBJ)
	@c++ $(CXXFLAG) $(OBJ) -o $(NAME)

$(OBJ_DIR):
	@mkdir -p $(OBJ_DIR)
	@mkdir -p $(OBJ_DIR)/server
	@mkdir -p $(OBJ_DIR)/http
	@mkdir -p $(OBJ_DIR)/config

r: re $(OBJ) $(NAME)
	@./$(NAME) $(CONF)

#run with valgrind
v: CXXFLAG += $(VAL)
v: re $(OBJ)
	@c++ $(CXXFLAG) $(OBJ) -o $(NAME)
	@valgrind $(VAL_FLAG) ./$(NAME)

clean:
	@rm -rf $(OBJ_DIR)

fclean: clean
	@rm -rf $(NAME)

re: fclean all

.PHONY: all r v clean fclean re

#                                                                 *=::.::=+#
#                                                               *.           :+
#                        +-:::-=                               *               .*
#                    #-          -#                           =.        ...      +
#                  #:           .:.#        ##+==--:::--==+#  #       -+=-===:    *
#                 +             :::-   :+-.                  ..      =-::::::-+.   %
#                +     ..:..    :::-#=.              -+##%%##+:     :+::::::::-+   +
#               #    -+=---==. :::::. :=+##%#*=.  :*%#********##*-   -=+=::::::+:.:=
#               -   +-::::::-+ .:..:+%##******#%##%************++#%*:  .:=+-:::+-::+
#              @   :=::::::-++   =#%*+**************************++**%#-   .=+-+=:::@
#              @.  +:::::-+=: :*%#**+******###******#%%#********++****%%=   .::::=%
#               +  ==::-+-  -#%#***++***##%#%%******%###%%#*****+++*****%%=.   :+@
#                = .+===. :#%******++**#%%%#%###********##%%#**++++*******%%-.   -=
#                 *  :: .*@#******+++###**##****************#%#++++*********@*:.   *
#                  =   :%%********+##+***#********************#%#++**********%%-.   *
#                 =   -@#*********%+++****************++**++++**%@#***********%%::.  *
#                *   =@*********#%+++++**+++*******++++++++++++**#%%***********#%-:.  #
#               #   =@*********#%*+++++*+++++++++++++++++*+++++***#%@***********#@=:. .%
#              @.  -@*********%#**+++*#*++++++++++++++++++*+++*****#%@#***********@+::.:%
#             .-  :@#********%%***+++##+++++++++++++++++++***##*****#%@************@+:::=@
#             *   %#********%@*****+*%#+++++++++++++++++++***#@#*****#%@************@+:::*
#            %.  +%********#@#*******%%++++++++++++++++++****#**%****##%@*********#*#@=:::%
#            =  :@*********@%#*******@%+++++++++++++++++****#%*.=@#***##@%********%**#@=::=@
#           %   #%**#*****#@#*******@@%**+**+++++++++****%%%%@*=::#%**###@#*******#%**#@-:.#
#           =  :@**##*****@%#*****#@++@*#%%*+++++++++******%%@++::.+@####%%*******#%***%%::-@
#          %.  #%**%#****#@##++++#@=.#@%#*+*+++++++++++++**%@+.::::::*@%##@*******#%#***@*:.#
#          +  :@***%#***+%%#*+++%%:::.#%+*+++++++++++++++++%%.  .::::.-#@%%#******#%#****@=:-#
#         @: .=%**#%#****@#**=#@+::::::%%+++++++=========++#*     ..:::.-*@%+*****#%#****%%::*
#         # ..##**%%#****@***%%-:::..:::#%*++==============**=.     ..:::::%*++++*#%******@+:-
#         = :-@***%##**+#%*%@*:::.    .:==##+=========#@%*+#%.:---======++=*#++++*#%******#%:.#
#        =::.#%***%##*++#@@%=.....:::--===*@@#+----=*@+.:=#@@@@@@@@@@@@@@@@=%=+++*%#*******@=:=
#        %:::@****#%#*++#@*:*#%%@@@@@@@@@@@@=-*%#*#%+.    :@@@%%%%%%#%%*###+@++++#%+*******%#.:%
#        *::+%*****%#*++#*..#@@@@@@%%%#%#*##+   .::        -#=========**.  .@++++%*+*******%%::*
#        =:.%#******%*++*#..:+#++=======*+                .#+===-======**   %*=+#%++*******#@::-@
#       %:::@********#+++%  .#+==========#-               -#--=-:-=....:*.  %*=+@+++********@-:.%
#       *::=@*******+**+=%: -#-:=::=-....=+               -=..:=-=+.....=.  @*=%*+++********@=::+=
#       -::*%********+++=## :=..===+:....--               .=:...-:.....--...@*%*+++*********@=::-@
#      @::.#%********++++*@=.=...::.....:=.                :=:........-=...=@++++++*********@-:::%
#      %.:.#%********++++*@@.:=:.......:=:                  .-=--::-==-....%%=++++*********#@:::.#
#      %:::%%********++++=#@*.:-=------:.                      ..::.......#%=+++++*********%*:::-%
#      *=:.%%********+++++=#@:.......                               .....%#=+++++*********#%:::-@
#       %:.#%*********+++++=#=...-.                :.                ...%#=++++++********#@-::+:
#        %:+@*********++++++=#:.-+ ..             +=*:                 #%+++++++********#@=.-%
#          =@#*********++++++=#-== -+             .                   =@+++++++********#@=-#
#            @***********++++++#=-+=.                            . :+#@%**+++*********#@%#
#     ##*#    @**************+++#+.                            .==.=*%@%##***********%@
#   #++++++#@##@%****************%@#+:                     .-+#@#***##%@#####******#=
#  #++++++++++++#@%**********#####%%%%%#**+==-:::::::--=+#%@%%########%@@####***#%@
# @+++--=+++++++++#%%#*******#####%%#####%**%@==+@###%%==:*######%@%%%@=-@###**%%%%+
# @+++-++++++++++++++*#%#****%###%#%%#%%#-*#-*:+%+====*#=+=*==%%%**%##-::#@%**#%###%:
#  %+++++++++++++++##**@#%%**%#%%*+*%#**=%-=#:+-=+++--+-=.@-*#:=#+=#*.=*     %%%%%
#    %*++++++*#%++++*#@####%#@%%*##+=###*#+##*****=:*###**%++%##-%#=+
#    %+++=++++++++++*#@@%%@@%*+++++%*=:.:= .#.  .+@-%=.  -*..*:-+%*@
#   @*+=-==+*%%%++++*@****++++++#%%+    ::= :*: %*:..#* =*. =::.  .#@
#   %+----==#%++=++--=+++++++++*%:#*:    :-= :* +#.  @-.%. =::.   .%*
#   %=------==+-------=+++++++*%*#:.=:   .:=-+*.=%  .@-.%:-=::   .=-##*
#   %=---------.:===--=+++++++%#*   .=: .:--==%-%+::.*%-@:=--.  .=.  +#*
#   @+--+=----=:  ..:=++++++++@+     .=::::--#@@*:+---*@@%--:: .=:    -%@
#    #+-*.*----=-------+++++++%:    .::=-:::*%@%%%%%%%%%@*=::::=:.     -
#     #++*=-----------+*******@=.  .::::+#=%@@%%%%%%%%@@@@@%-+=::::.   :
#      @*+++++++++=-=*+===++++#%-:.:::=##-+-...-@%%%%%@=:::=%#%=:::::..=
#         @%**+==+*++=----+++++*%##*= ==-.    :=%%%%%%#--  .:::*#+-:::=%
#         %+=---=++**=--==++++++*     *.:=. .=-:%%#%%%@:-=: .==::%
#         =-----=*+*.#++++++++++@    %.  .--=..:@#####@+::-==.:::-=
#         #=====+**%  +**####%@      =         =@%%%##%*      .:::+
#          #****##@                                     ++===+*#%








